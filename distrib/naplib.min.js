/*! naplibtemp 2014-01-30 */
var MGNapier=MGNapier||{};MGNapier.AdaptedD3=new function(){function a(a){return a.children}function b(a){return a.value}function c(a,b){return b.value-a.value}function d(){return!0}function e(a,b){return d3.rebind(a,b,"sort","children","value","filter"),a.nodes=a,a.links=f,a}function f(a){return d3.merge(a.map(function(a){return(a.children||[]).map(function(b){return{source:a,target:b}})}))}function g(a,b,c,d,e,f,g,h){var i=h.depth;if(0===i&&(f.length=Math.min(f.length,Math.max(4,Math.min(f.length,Math.floor(d/g*(d/g)))))),d/Math.sqrt(f.length)<g&&f.length>4){VESPER.log("GRIDFAIL",d,f.length,Math.sqrt(f.length),g,i);var j=f[0];return void a.push({id:"*"+b(h),x:c,y:j.depth*e,dx:d,dy:e})}VESPER.log("GRIDGOOD",d,f.length,Math.sqrt(f.length),g,i);for(var k=1,l=f.length/k,m=Math.ceil(Math.sqrt(l)),n=m,o=Math.max(1,Math.floor(m*k)),p=0,q=0,r=d/o,s=e/Math.max(1,Math.floor(m)),t=0;t<f.length;t++){var u=f[t],v=b(u);a.push({id:v,x:c+p*r,y:(u.depth+q/m)*e,dx:r,dy:s}),q++,q>=n&&(q=0,p++)}}this.adaptedHierarchy=function(){function d(a,b,c){var e=h.call(f,a,b);a.depth=b,c.push(a);var j;if(e&&(j=e.length)){for(var k,l=-1,m=0,n=b+1;++l<j;)k=d(e[l],n,c),k.parent=a,m+=k.value||i&&i.call(f,k,k.depth)||0;g&&e.sort(g),i&&(a.value=m)}return a}function e(a,b){var c=h.call(f,a,b),d=0;if(c&&(g=c.length))for(var g,j=-1,k=b+1;++j<g;)d+=e(c[j],k);else i&&(d=+i.call(f,a,b)||0);return i&&(a.value=d),d}function f(a){var b=[];return d(a,0,b),b}var g=c,h=a,i=b;return f.sort=function(a){return arguments.length?(g=a,f):g},f.children=function(a){return arguments.length?(h=a,f):h},f.value=function(a){return arguments.length?(i=a,f):i},f.revalue=function(a){return e(a,0),a},f},this.taxonomicHierarchy=function(){function e(a,b,c){var d=i.call(g,a,b);a.depth=b,c.push(a);var f;if(d&&(f=d.length)){for(var l,m=-1,n=0,o=b+(k(a)?1:0);++m<f;)l=e(d[m],o,c),l.parent=a,n+=l.value||j&&j.call(g,l,l.depth)||0;h&&d.sort(h),j&&(a.value=n)}return a}function f(a,b){var c=i.call(g,a,b),d=0;if(c&&(e=c.length))for(var e,h=-1,k=b+1;++h<e;)d+=f(c[h],k);else j&&(d=+j.call(g,a,b)||0);return j&&(a.value=d),d}function g(a){var b=[];return e(a,0,b),b}var h=c,i=a,j=b,k=d;return g.sort=function(a){return arguments.length?(h=a,g):h},g.children=function(a){return arguments.length?(i=a,g):i},g.value=function(a){return arguments.length?(j=a,g):j},g.filter=function(a){return arguments.length?(k=a,g):k},g.revalue=function(a){return f(a,0),a},g},this.bottomUp=function(){function a(b,c,e,h,j){var k=f.children()(c);if(h>i){var l=d(c);b.push({id:l,x:e,y:c.depth*j,dx:h,dy:j});var m,n=[],o=0;if(k&&(m=k.length)){var p,q,r=-1,s=c.value?c.value:f.value().call(f,c,c.depth);for(h/=s;++r<m;)p=k[r],q=(p.value||f.value().call(f,p,p.depth))*h,i>=q?(n.push(p),o+=q):(a(b,p,e,q,j),e+=q);n.length>0&&g(b,d,e,o,j,n,i,c)}}}function b(a,c){var d=f.children()(a),e=0;if(d&&(g=d.length)){for(var g,h=-1,j=c/(a.value||1),k=!1;++h<g;){var l=d[h].value||f.value()&&f.value().call(f,d[h],d[h].depth)||0;j*l>i?e=Math.max(e,b(d[h],j*l)):k=!0}k&&0===e&&(e=1)}return 1+e}function c(c,d){f.call(this,c,d);var e=[];return a(e,c,0,h[0],h[1]/b(c,h[0])),e}var d,f=this.taxonomicHierarchy(),h=[1,1],i=1;return c.size=function(a){return arguments.length?(h=a,c):h},c.nodeId=function(a){return arguments.length?(d=a,c):d},c.cutoff=function(a){return arguments.length?(i=a,c):i},e(c,f)},this.logPartition=function(){function a(a){return a.value||h.value()&&h.value().call(h,a,a.depth)||0}function b(c,d,e,i,k){var l=h.children()(d);if(i>j){var m=f(d);c.push({id:m,x:e,y:d.depth*k,dx:i,dy:k});var n,o=[],p=0;if(l&&(n=l.length)){for(var q=-1,r=0;++q<n;)r+=Math.log(a(l[q])+1);q=-1;var s,t;for(i/=r;++q<n;)s=l[q],t=Math.log(a(s)+1)*i,j>=t?(o.push(s),p+=t):(b(c,s,e,t,k),e+=t);o.length>0&&g(c,f,e,p,k,o,j,d)}}}function c(b,d){var e=h.children()(b),f=0;if(e&&(g=e.length)){for(var g,i=-1,k=0;++i<g;)k+=Math.log(a(e[i])+1);i=-1;for(var l=d/k,m=!1;++i<g;){var n=e[i],o=Math.log(a(n)+1)*l;o>j?f=Math.max(f,c(n,o)):m=!0}m&&0===f&&(f=1)}return 1+f}function d(a,d){h.call(this,a,d);var e=[];return b(e,a,0,i[0],i[1]/c(a,i[0])),e}var f,h=this.taxonomicHierarchy(),i=[1,1],j=1;return d.size=function(a){return arguments.length?(i=a,d):i},d.nodeId=function(a){return arguments.length?(f=a,d):f},d.cutoff=function(a){return arguments.length?(j=a,d):j},e(d,h)},this.topDown=function(){function a(b,c,e,h,j){var k=f.children()(c);if(h>i){var l=d(c);f.filter()(c)&&b.push({id:l,x:e,y:c.depth*j,dx:h,dy:j});var m,n=[],o=0;if(k&&(m=k.length)){var p,q,r=-1;for(h/=m;++r<m;)p=k[r],q=h,i>=q?(n.push(p),o+=q):(a(b,p,e,q,j),e+=q);n.length>0&&g(b,d,e,o,j,n,i,c)}}}function b(a,c){var d,e=f.children()(a),g=0,h=-1;if(e&&(d=e.length)&&c/d>i)for(;++h<d;)g=Math.max(g,b(e[h],c/d));return i>=c/d&&0===g&&(g=1),(f.filter()(a)?1:0)+g}function c(c,d){f.call(this,c,d);var e=[];return a(e,c,0,h[0],h[1]/b(c,h[0])),e}var d,f=this.taxonomicHierarchy(),h=[1,1],i=1;return c.size=function(a){return arguments.length?(h=a,c):h},c.nodeId=function(a){return arguments.length?(d=a,c):d},c.cutoff=function(a){return arguments.length?(i=a,c):i},e(c,f)}};var MGNapier=MGNapier||{};MGNapier.NapVisLib=new function(){function a(a,b){for(var c=0;c<a.from.length;c++)for(var d=a.from[c],e=0;e<a.to.length;e++){var f=a.to[e];void 0==b[d]&&(b[d]={}),void 0==b[f]&&(b[f]={}),void 0==b[d][f]&&(b[d][f]=0,b[f][d]=0),b[d][f]++,b[f][d]++}}function b(a,b){for(var c=0;c<a.length;c++)for(var d=a[c],e=c;e<a.length;e++){var f=a[e];void 0==b[d]&&console.log("no "+d+" defined"),void 0==b[d][f]&&(b[d][f]=0,b[f][d]=0),b[d][f]++,d!==f&&b[f][d]++}}function c(a){var b="";switch(a.code){case FileError.QUOTA_EXCEEDED_ERR:b="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:b="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:b="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:b="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:b="INVALID_STATE_ERR";break;default:b="Unknown Error"}console.log("Error: "+b)}var d=this;this.getDivDims=function(a){var b=document.getElementById(a.substring(1)),c=b.clientWidth,d=b.clientHeight;return{width:c,height:d}},this.addEvent=function(a,b,c){null!==a&&void 0!==a&&(a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c)},this.showProps=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&"responseText"!==c&&"responseXML"!==c&&b.push(c);for(var d=0;d<b.length;d++)console.log(b[d]+" : ",a[b[d]])},this.getStyle=function(a){var b;return b="undefined"!=typeof a.currentStyle?a.currentStyle:document.defaultView.getComputedStyle(a,null)},this.getStyle3=function(a,b,c){if(document.styleSheets){for(var d,e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].href.search(b)>=0){d=document.styleSheets[e];break}if(void 0===d&&(d=document.styleSheets[a]),void 0!==d){var f;d.cssRules?f=d.cssRules:d.rules&&(f=d.rules);var g=-1;if(f){for(var e=0;e<f.length;e++)if(f[e].selectorText===c){g=e;break}return-1===g?null:f[e]}}}return null},this.getWidthHeight=function(a,b){var c=[a.clientWidth,a.clientHeight];if(0===c[0]&&b){var d=this.getStyle(a);c=[parseInt(d.width),parseInt(d.height)]}return c},this.getValueFromRule=function(a,b){return null==a?null:a.style[b]},this.getSelectedStylesheetRefs=function(a){var b=a.selectedStyleSheetSet,c=[];if(a.styleSheets)for(var d=0;d<a.styleSheets.length;d++)a.styleSheets[d].title===b&&c.push(a.styleSheets[d].href);return c},this.drawButton=function(a,b,c,d,e,f){var g=a.append("svg:g").attr("transform","translate("+c+","+d+")"),h=g.append("svg:rect").attr("class","buttonbase").attr("width",e).attr("height",f).attr("x",0).attr("y",0).attr("ry",10),i=g.append("svg:text").attr("x",e/2).attr("y",(f+10)/2).attr("text-anchor","middle").attr("class","controlText").text(b);return{base:h,text:i}},this.speedTest=function(a,b){for(var c=0;c<a.length;c++){for(var d=a[c],e=d.func,f=d.args,g=makeTime(),h=0;b>h;h++)e.apply(this,f);var i=makeTime()-g;console.log("time for "+d.name+": "+i+" ms.")}},this.loginfowrap=function(a,b){if(a){for(var c="",d=0;d<b.length;d++)c+=b[d],d<b.length-1&&(c+="	");a.info(c)}},this.resetStopwatch=function(a){a.base=this.makeTime()},this.elapsedStopwatch=function(a){return d.makeTime()-a.base},this.d3fadeAndRemoveGroups=function(a,b,c){for(var d=0;d<a.length;d++)a[d].transition().delay(c).duration(b).style("opacity",0).remove()},this.d3fadeInNewGroups=function(a,b,c){for(var d=0;d<a.length;d++)a[d].transition().delay(c).duration(b).style("opacity",1)},this.newFilledArray=function(a,b){for(var c=[],d=0;a>d;)c[d++]=b;return c},this.arrayClear2D=function(a){for(var b=0;b<a.length;b++)for(var c=0;c<a[b].length;c++)a[b][c]=0},this.arrayCopy2D=function(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<a[c].length;d++)b[c][d]=a[c][d]},this.makeGraph=function(a,c,d,e,f){for(var g=c.length,h={},i=0;g>i;i++)h[c[i].key]={};for(var j={},k=0;k<c.length;k++){var l=c[k],m=l.value[f];if(m&&m instanceof Array&&m.length>0)for(var n=0;n<m.length;n++){var o=m[n];j[o]||(j[o]=[]),j[o].push(l.key)}}for(var o in j)j.hasOwnProperty(o)&&b(j[o],h);return h},this.makeGraph2=function(b,c,d,e,f,g,h){for(var i,j,k=c.length,l={},m=[],n=[],o=f===g,p=0;k>p;p++)l[c[p].key]={};for(var q={},r=0;r<c.length;r++){var s=c[r];if(m.push(s.key),j=s.value[h],j&&j instanceof Array&&j.length>0)for(var t=0;t<j.length;t++)i=j[t],q[i]||(q[i]={from:[],to:[]}),q[i].from.push(s.key)}for(r=0;r<d.length;r++){var u=d[r];if(n.push(u.key),j=u.value[h],j&&j instanceof Array&&j.length>0)for(var t=0;t<j.length;t++)i=j[t],q[i]||(q[i]={from:[],to:[]}),q[i].to.push(u.key)}for(i in q)q.hasOwnProperty(i)&&a(q[i],l);if(o)for(p=0;p<m.length;p++)for(var v=m[p],w=0;w<n.length;w++){var x=n[w];l[v]&&l[v][x]&&(l[v][x]/=2)}return{data:l,sources:m,targets:n}},this.makeTime=function(){return(getTimestamp=window.performance&&window.performance.now?function(){return window.performance.now()}:window.performance&&window.performance.webkitNow?function(){return window.performance.webkitNow()}:function(){return(new Date).getTime()})()},this.zip=function(a){return a[0].map(function(b,c){return a.map(function(a){return a[c]})})},this.objFilter=function(a,b){var c={};for(var d in a)a.hasOwnProperty(d)&&!b(a[d])&&(c[d]=a[d]);return c},this.countObjProperties=function(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b},this.getBinaryFromXHR=function(a){for(var b=a.responseBody,c={},d=0;256>d;d++)for(var e=0;256>e;e++)c[String.fromCharCode(d+(e<<8))]=String.fromCharCode(d)+String.fromCharCode(e);var f=IEBinaryToArray_ByteStr(b),g=IEBinaryToArray_ByteStr_Last(b);return f.replace(/[\s\S]/g,function(a){return c[a]})+g},this.xhr=function(a,b,c){var d=new window.XMLHttpRequest;arguments.length<3?(c=b,b=null):b&&d.overrideMimeType&&d.overrideMimeType(b),d.open("GET",a,!0),b&&d.setRequestHeader("Accept",b),d.onreadystatechange=function(){if(4===d.readyState){var a=d.status;c(!a&&d.response||a>=200&&300>a||304===a?d:null)}},d.send(null)},this.jqueryXhr=function(a,b,c){$.ajax(a,{mimeType:b,headers:{Accept:b}}).done(function(a,b,d){c(d)})},this.xhr2=function(a,b,c){var d=new XMLHttpRequest;arguments.length<3&&(c=b,b=null),d.open("GET",a,!0),d.responseType="arraybuffer",b&&d.setRequestHeader("Accept",b),d.onreadystatechange=function(){if(4===d.readyState){var a=d.status;c(!a&&d.response||a>=200&&300>a||304===a?d:null)}},d.send(null)},this.jqueryXhr2=function(a,b,c){$.ajax(a,{responseType:"arrayBuffer",mimeType:b,headers:{Accept:b}}).done(function(a,b,d){c(d)})},this.getText=function(a){var b;return void 0!==a.responseBody&&void 0==a.overrideMimeType?(console.log("Having to get binary out of XHR using VBScript in IE."),b=d.getBinaryFromXHR(a)):b=a&&(a.response||a.responseText),console.log("text loaded:",b.length,"bytes"),b},this.parseXML=function(a){var b;if(window.DOMParser){var c=new DOMParser;b=c.parseFromString(a,"text/xml")}else{if(!window.ActiveXObject)throw new Error("Cannot parse XML");b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)}return b},this.xmlToString=function(a){var b;return b=window.ActiveXObject?a.xml:(new XMLSerializer).serializeToString(a)},this.endsWith=function(a,b){return-1!==a.indexOf(b,a.length-b.length)},this.removeNullsFromArray=function(a){for(var b=0,c=0;c<a.length;c++)void 0!=a[c]&&null!=a[c]&&(c>b&&(a[b]=a[c]),b++);a.length=b},this.intersectArrays=function(a,b){return void 0===a||void 0===b?[]:$.grep(a,function(a){return $.inArray(a,b)>-1})},this.countNulls=function(a){for(var b=0,c=0;c<a.length;c++)null===a[c]&&b++;return b},this.html5Lacks=function(a,b){a.append("p").attr("class","html5lack").text(b)},this.html5LacksOnButton=function(a,b){a.property("disabled",!0),a.attr("title",b)},this.makeFileLoadButton=function(a,b,c,e,f){var g=a.select("input[type=file]#"+c);return g.empty()&&(g=a.append("input").attr("class",b).attr("id",c),window.FileReader?g.attr("type","file").on("change",function(){var a=new FileReader;console.log("local file loading"),a.onload=function(a){var b=d3.select("#"+c).node().files[0],d=a.target.result;f(b,d)},a.readAsArrayBuffer(d3.select(d3.event.target).node().files[0])}):d.html5Lacks(a,"This Browser does not support the HTML5 FileReader API")),g},this.prepareForWrite=function(a,b){navigator.webkitPersistentStorage.requestQuota(1048576,function(e){console.log("granted bytes",arguments),window.requestFileSystem(window.PERSISTENT,e,function(c){d.writeLocalFile(c,a(b))},c)},function(a){console.log("Error",a)})},this.writeArray=function(a){return a.join("\n")},this.writeLocalFile=function(a,b){console.log("args",arguments),a.root.getFile("Save.txt",{create:!0},function(a){var d=a.toURL();a.createWriter(function(a){a.onwriteend=function(){console.log(this.isTruncated?"File truncated":"Write completed",": ",this.position,"bytes."),this.isTruncated?window.open(d,"_blank","height=600,width=320,status=1,location=1"):(this.isTruncated=!0,this.truncate(this.position))},a.onerror=function(a){console.log("Write failed: "+a.toString())};var c=new Blob([b],{type:"text/plain"});a.isTruncated=!1,a.write(c)},c)},c)},window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,this.makeSectionedDiv=function(a,b,c){var d=a.attr("id"),e=a.selectAll("div."+c).data(b,function(a){return a.header}),f=e.enter().append("div").attr("class",c),g=f.append("p").attr("class","controlHeading");g.append("button").attr("class","expansionControl").attr("id",function(a){return d+a.sectionID+"toggle"}).text(function(a){return"none"===a.init?"+":"-"}).on("click",function(a){var b=d+a.sectionID,c=d3.select("#"+b),e=c.style("display");c.style("display","block"===e?"none":"block"),d3.select(this).html("block"===e?"+":"-")}),g.append("label").attr("for",function(a){return d+a.sectionID+"toggle"}).text(function(a){return a.header}),f.append("div").attr("id",function(a){return d+a.sectionID}).style("display",function(a){return a.init||"block"})},this.addHRGrooves=function(a){var b=a.attr("id"),c=a.append("div").attr("id",b+"dragger");c.append("hr"),c.append("hr"),c.append("hr"),c.append("hr")},this.rangeSlider=function(){function a(b){function g(){f(e,a.scale())}var i=d3.behavior.drag().on("drag",function(){e[0]=Math.max(d.range()[0],Math.min(e[1],e[0]+d3.event.dx)),a.update()}),j=d3.behavior.drag().on("drag",function(){e[1]=Math.min(d.range()[1],Math.max(e[0],e[1]+d3.event.dx)),a.update()}),k=d3.behavior.drag().on("drag",function(){var b=d3.event.dx>0?Math.min(d3.event.dx,d.range()[1]-e[1]):Math.max(d3.event.dx,d.range()[0]-e[0]);e[0]+=b,e[1]+=b,a.update()});i.on("dragend",g),j.on("dragend",g),k.on("dragend",g),b.each(function(){var a=d3.select(this);a.append("rect").attr("class","sliderThumb sliderMin").attr("width",16).attr("height",16).call(i).append("svg:title"),a.append("rect").attr("class","sliderThumb sliderMax").attr("width",16).attr("height",16).call(j).append("svg:title"),a.append("rect").attr("class","sliderBar").attr("x",e[0]).attr("y",2).attr("width",e[1]-e[0]).attr("height",12).call(k).append("svg:title")}),c=function(){return b.select("rect.sliderMax").attr("x",function(){return e[1]}).select("title").text(h.max(e,d)),b.select("rect.sliderMin").attr("x",function(){return e[0]-d3.select(this).attr("width")}).select("title").text(h.min(e,d)),b.select("rect.sliderBar").attr("x",function(){return e[0]}).attr("width",function(){return e[1]-e[0]}).select("title").text(h.bar()),a}}var b,c,d=d3.scale.linear(),e=[d.range()[0],d.range()[1]],f=function(a,b){console.log("drag end",d3.event,a,b)},g=function(){},h={min:function(a,b){return"min: "+b.invert(a[0])},max:function(a,b){return"max: "+b.invert(a[1])},bar:function(){return null}};return a.scale=function(b){return arguments.length?(d=b.copy(),e=[d.range()[0],d.range()[1]],a):d},a.orient=function(c){return arguments.length?(b=c in d3_svg_axisOrients?c+"":d3_svg_axisDefaultOrient,a):b},a.update=function(b){return arguments.length?(c=b,a):(c(),a)},a.dragEndFunc=function(b){return arguments.length?(f=b,a):f},a.duringDragFunc=function(b){return arguments.length?(g=b,a):g},a.tooltipTemplates=function(b){return arguments.length?(h=b,a):h},a}};var MGNapier=MGNapier||{};MGNapier.SharedSelection=function(){var a=[],b={},c=[],d=!1,e=!1;this.update=function(){if(!e)for(var b=0;b<a.length;b++)a[b].updateVals()},this.addVis=function(a){for(var b=0;b<a.length;b++)this.addSingleVis(a[b])},this.addSingleVis=function(b){var c=a?a.indexOf(b):-1;0>c&&a.push(b)},this.removeVis=function(b){var c=a?a.indexOf(b):-1;c>=0&&a.splice(c,1)},this.getVis=function(){return a.slice(0)},this.go=function(){for(var b=0;b<a.length;b++)a[b].go()},this.addToMap=function(a){b[a]=!0,d=!0,this.update()},this.removeFromMap=function(a){delete b[a],d=!0,this.update()},this.addAllToMap=function(a){for(var c=0;c<a.length;c++)b[a[c]]=!0;d=!0,this.update()},this.removeAllFromMap=function(a){for(i=0;i<a.length;i++)delete b[a[i]];d=!0,this.update()},this.contains=function(a){return b[a]?!0:!1},this.clear=function(){b={},c.length=0,d=!1},this.values=function(){return c=d?d3.keys(b):c,d=!1,c},this.setUpdating=function(a){a!==e&&(e=a,a===!1&&this.update())}};